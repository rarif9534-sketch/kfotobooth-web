<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K-FOTOBOOTH | Admin & Download</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; background: #0f172a; color: white; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .card { background: #1e293b; padding: 20px; border-radius: 20px; width: 100%; max-width: 400px; text-align: center; border: 1px solid #334155; }
        .btn { width: 100%; padding: 20px; border-radius: 15px; border: none; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 15px; }
        .btn-green { background: #22c55e; color: white; }
        .btn-blue { background: #3b82f6; color: white; }
        .btn-download { background: #BBE93C; color: black; text-decoration: none; display: block; }
        img { width: 100%; border-radius: 10px; margin-top: 15px; }
    </style>
</head>
<body>

    <div id="customer-view" style="display: none;" class="card">
        <h2 style="color: #BBE93C;">K-FOTOBOOTH DIGITAL</h2>
        <p>Terima kasih sudah berfoto! âœ¨</p>
        <img id="photo-result" src="" alt="Foto Kamu">
        <a id="download-link" href="" download class="btn btn-download">SIMPAN KE HP</a>
    </div>

    <div id="admin-view" style="display: none;" class="card">
        <h2>ADMIN REMOTE</h2>
        <div id="status" style="color: #38bdf8; font-weight: bold; margin-bottom: 10px;">READY</div>
        <button onclick="kirimSinyal('waiting', 'AKTIVASI FOTO')" class="btn btn-green">KONFIRMASI BAYAR (MULAI)</button>
        <button onclick="kirimSinyal('extra_print', 'TAMBAH PRINT')" class="btn btn-blue">TAMBAH 1X PRINT</button>
    </div>

    <script>
        const supabaseUrl = 'https://clscititqndvofpsqayr.supabase.co';
        const supabaseKey = 'sb_publishable_dEklOd6DLK5CIgRXYZbZ3g_DmXVEIj6';
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

        const urlParams = new URLSearchParams(window.location.search);
        const sId = urlParams.get('s');

        if (sId) {
            // MODE DOWNLOAD
            document.getElementById('customer-view').style.display = 'block';
            const imgUrl = `${supabaseUrl}/storage/v1/object/public/photos/${sId}.jpg`;
            document.getElementById('photo-result').src = imgUrl;
            document.getElementById('download-link').href = imgUrl;
        } else {
            // MODE ADMIN
            document.getElementById('admin-view').style.display = 'block';
        }

        async function kirimSinyal(status, label) {
            document.getElementById('status').innerText = "MENGIRIM...";
            const { error } = await supabaseClient.from('remote_control').update({ is_paid: true, session_status: status }).eq('id', 1);
            if (error) alert(error.message);
            else {
                document.getElementById('status').innerText = label + " OK!";
                setTimeout(() => { document.getElementById('status').innerText = "READY"; }, 3000);
            }
        }
    </script>
</body>
</html>